<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="nora-common.css">
<title>TSA App â€“ Besoins</title>

<style>
body{
padding-bottom:80px;
}

.page-title-header{font-size:20px}

.profile-banner{
background:var(--dark);
padding:12px 20px;
font-size:16px;
}

.main-content{padding:24px 20px}

.page-title{
font-size:26px;
margin-bottom:8px;
}

.instruction-text{
color:var(--accent);
font-size:15px;
margin-bottom:20px;
}

.reset-button{
background:rgba(245,228,204,.2);
border:1px solid rgba(245,228,204,.3);
color:var(--light);
border-radius:12px;
font-size:26px;
padding:8px 14px;
cursor:pointer;
}

.need-item{
padding:14px 16px;
border-radius:12px;
margin-bottom:10px;
cursor:pointer;
transition: all 0.2s;
user-select:none;

border:2px solid var(--bg);
background:var(--light);
color:var(--dark);

display:flex;
align-items:center;
gap:14px;
}

.need-item:active{transform:scale(.97)}

.need-item.active{
background:var(--accent);
color:var(--dark);
border:2px solid var(--bg);
box-shadow:0 4px 8px rgba(0,0,0,0.2);
}

.need-icon{font-size:24px}
.need-text{flex:1;font-size:16px}

.more-toggle{
margin:22px 0;
background:none;
border:none;
color:var(--accent);
font-size:16px;
cursor:pointer;
}

.confirm-overlay{
position:fixed;
inset:0;
background:rgba(0,0,0,.7);
display:none;
align-items:center;
justify-content:center;
z-index:100;
}

.confirm-overlay.show{display:flex}

.confirm-dialog{
background:var(--light);
padding:24px;
border-radius:16px;
width:300px;
color:var(--dark);
}

.confirm-buttons{
display:flex;
gap:12px;
margin-top:20px;
}

.confirm-btn{
flex:1;
padding:12px;
border-radius:8px;
border:none;
font-weight:600;
cursor:pointer;
}

.confirm{background:var(--accent)}
.cancel{background:#ddd}
</style>
</head>

<body>

<header class="header">
<h1 class="page-title-header">Besoins</h1>
</header>

<div class="profile-banner">Maison</div>

<main class="main-content">

<div style="display:flex;justify-content:space-between;align-items:center">
<h2 class="page-title">Mes besoins actuels</h2>
<button class="reset-button" onclick="resetAllNeeds()">â†»</button>
</div>

<p class="instruction-text">Appuyez pour sÃ©lectionner. Appui long pour remettre Ã  zÃ©ro.</p>

<!-- BESOINS PRIORITAIRES -->
<div class="need-item" data-need="RÃ©duire le bruit" data-icon="ğŸ”‡" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ”‡</div>
<div class="need-text">RÃ©duire le bruit</div>
</div>

<div class="need-item" data-need="ÃŠtre dans le noir / pÃ©nombre" data-icon="ğŸŒ‘" onclick="toggleNeed(this)">
<div class="need-icon">ğŸŒ‘</div>
<div class="need-text">ÃŠtre dans le noir / pÃ©nombre</div>
</div>

<div class="need-item" data-need="ÃŠtre au calme" data-icon="ğŸ¤«" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ¤«</div>
<div class="need-text">ÃŠtre au calme</div>
</div>

<div class="need-item" data-need="Casque / Ã©couteurs" data-icon="ğŸ§" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ§</div>
<div class="need-text">Casque / Ã©couteurs</div>
</div>

<div class="need-item" data-need="Me coucher / m'allonger" data-icon="ğŸ›ï¸" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ›ï¸</div>
<div class="need-text">Me coucher / m'allonger</div>
</div>

<div class="need-item" data-need="M'asseoir" data-icon="ğŸª‘" onclick="toggleNeed(this)">
<div class="need-icon">ğŸª‘</div>
<div class="need-text">M'asseoir</div>
</div>

<div class="need-item" data-need="Appeler les secours" data-icon="ğŸš‘" onclick="toggleNeed(this)">
<div class="need-icon">ğŸš‘</div>
<div class="need-text">Appeler les secours</div>
</div>

<button class="more-toggle" onclick="toggleMore()">â• Voir plus de besoins</button>

<div id="moreNeeds" style="display:none">

<div class="need-item" data-need="Boire" data-icon="ğŸ’§" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ’§</div>
<div class="need-text">Boire</div>
</div>

<div class="need-item" data-need="Manger" data-icon="ğŸ½ï¸" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ½ï¸</div>
<div class="need-text">Manger</div>
</div>

<div class="need-item" data-need="Aller aux WC" data-icon="ğŸš»" onclick="toggleNeed(this)">
<div class="need-icon">ğŸš»</div>
<div class="need-text">Aller aux WC</div>
</div>

<div class="need-item" data-need="Dormir" data-icon="ğŸ˜´" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ˜´</div>
<div class="need-text">Dormir</div>
</div>

<div class="need-item" data-need="Un cÃ¢lin" data-icon="ğŸ¤—" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ¤—</div>
<div class="need-text">Un cÃ¢lin</div>
</div>

<div class="need-item" data-need="ÃŠtre seule" data-icon="ğŸšª" onclick="toggleNeed(this)">
<div class="need-icon">ğŸšª</div>
<div class="need-text">ÃŠtre seule</div>
</div>

<div class="need-item" data-need="ÃŠtre accompagnÃ©e" data-icon="ğŸ‘¥" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ‘¥</div>
<div class="need-text">ÃŠtre accompagnÃ©e</div>
</div>

<div class="need-item" data-need="Qu'on reste avec moi" data-icon="ğŸ«‚" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ«‚</div>
<div class="need-text">Qu'on reste avec moi</div>
</div>

<div class="need-item" data-need="Attendre" data-icon="â³" onclick="toggleNeed(this)">
<div class="need-icon">â³</div>
<div class="need-text">Attendre</div>
</div>

<div class="need-item" data-need="Appeler quelqu'un" data-icon="ğŸ“" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ“</div>
<div class="need-text">Appeler quelqu'un</div>
</div>

<div class="need-item" data-need="Qu'on appelle quelqu'un pour moi" data-icon="â˜ï¸" onclick="toggleNeed(this)">
<div class="need-icon">â˜ï¸</div>
<div class="need-text">Qu'on appelle quelqu'un pour moi</div>
</div>

<div class="need-item" data-need="ConnaÃ®tre l'heure" data-icon="ğŸ•" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ•</div>
<div class="need-text">ConnaÃ®tre l'heure</div>
</div>

<div class="need-item" data-need="Comprendre ce qui se passe" data-icon="â“" onclick="toggleNeed(this)">
<div class="need-icon">â“</div>
<div class="need-text">Comprendre ce qui se passe</div>
</div>

<div class="need-item" data-need="Qu'on m'explique calmement" data-icon="ğŸ’¬" onclick="toggleNeed(this)">
<div class="need-icon">ğŸ’¬</div>
<div class="need-text">Qu'on m'explique calmement</div>
</div>

</div>

</main>

<footer class="footer">
  <button class="footer-button icon" onclick="goBack()">â¬…ï¸</button>
  <button class="footer-button center" onclick="finish()">Voir le rÃ©capitulatif</button>
  <button class="footer-button icon" onclick="goNext()">â¡ï¸</button>
</footer>

<div class="confirm-overlay" id="confirmOverlay">
<div class="confirm-dialog">
<h3>RÃ©initialiser ?</h3>
<p>Tous les besoins seront remis Ã  zÃ©ro.</p>
<div class="confirm-buttons">
<button class="confirm-btn cancel" onclick="hideConfirm()">Annuler</button>
<button class="confirm-btn confirm" onclick="confirmReset()">OK</button>
</div>
</div>
</div>

<script>
let longPressTimer, isLongPress = false;

function toggleNeed(el){
  if(isLongPress){
    isLongPress = false;
    return;
  }
  el.classList.toggle('active');
  saveBesoins();
}

document.querySelectorAll('.need-item').forEach(i => {
  i.addEventListener('mousedown', () => startLong(i));
  i.addEventListener('mouseup', clear);
  i.addEventListener('mouseleave', clear);
  i.addEventListener('touchstart', () => startLong(i));
  i.addEventListener('touchend', clear);
});

function startLong(i){
  isLongPress = false;
  longPressTimer = setTimeout(() => {
    isLongPress = true;
    i.classList.remove('active');
    saveBesoins();
  }, 600);
}

function clear(){
  clearTimeout(longPressTimer);
}

function toggleMore(){
  const b = document.getElementById('moreNeeds');
  b.style.display = b.style.display === 'block' ? 'none' : 'block';
}

function resetAllNeeds(){
  document.getElementById('confirmOverlay').classList.add('show');
}

function hideConfirm(){
  document.getElementById('confirmOverlay').classList.remove('show');
}

function confirmReset(){
  document.querySelectorAll('.need-item').forEach(i => {
    i.classList.remove('active');
  });
  saveBesoins();
  hideConfirm();
}

// Sauvegarde des besoins dans le localStorage
function saveBesoins(){
  const besoins = [];
  
  document.querySelectorAll('.need-item.active').forEach(item => {
    const label = item.dataset.need || item.querySelector('.need-text').textContent;
    const icon = item.dataset.icon || item.querySelector('.need-icon').textContent;
    
    besoins.push({
      label: label,
      icon: icon
    });
  });
  
  localStorage.setItem('currentBesoins', JSON.stringify(besoins));
  console.log('Besoins sauvegardÃ©s:', besoins);
}

// Charger les besoins au dÃ©marrage
function loadBesoins(){
  try {
    const saved = localStorage.getItem('currentBesoins');
    if(!saved) return;
    
    const besoins = JSON.parse(saved);
    
    document.querySelectorAll('.need-item').forEach(item => {
      const label = item.dataset.need || item.querySelector('.need-text').textContent;
      
      const isActive = besoins.some(b => b.label === label);
      if(isActive){
        item.classList.add('active');
      }
    });
    
    console.log('Besoins chargÃ©s:', besoins);
  } catch(e) {
    console.error('Erreur chargement besoins:', e);
  }
}

function goBack(){
  saveBesoins();
  location.href = 'capacites.html';
}

function goNext(){
  saveBesoins();
  location.href = 'etats.html';
}

function finish(){
  saveBesoins();
  location.href = 'recap.html';
}

// Charger au dÃ©marrage
document.addEventListener('DOMContentLoaded', loadBesoins);
</script>

</body>
</html>