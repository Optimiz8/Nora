<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="nora-common.css">
<title>TSA App - Comment je me sens</title>
<style>
body{
padding-bottom:80px;
}

.profile-banner{
background:var(--dark);
padding:12px 20px;
font-size:16px;
}

.main-content{padding:24px 20px}

.page-title{
font-size:26px;
margin-bottom:8px;
}

.instruction-text{
color:var(--accent);
font-size:15px;
margin-bottom:20px;
}

.reset-button{
background:rgba(245,228,204,.2);
border:1px solid rgba(245,228,204,.3);
color:var(--light);
border-radius:12px;
font-size:26px;
padding:8px 14px;
cursor:pointer;
}

.state-item{
padding:14px 16px;
border-radius:12px;
margin-bottom:10px;
cursor:pointer;
transition: all 0.2s;
user-select:none;

border:2px solid var(--bg);
background:var(--light);
color:var(--dark);

display:flex;
align-items:center;
gap:14px;
}

.state-item:active{transform:scale(.97)}

.state-item.active{
background:var(--accent);
color:var(--dark);
border:2px solid var(--bg);
box-shadow:0 4px 8px rgba(0,0,0,0.2);
}

.state-icon{font-size:24px}
.state-text{flex:1;font-size:16px}

.more-toggle{
margin:22px 0;
background:none;
border:none;
color:var(--accent);
font-size:16px;
cursor:pointer;
}

.confirm-overlay{
position:fixed;
inset:0;
background:rgba(0,0,0,.7);
display:none;
align-items:center;
justify-content:center;
z-index:100;
}

.confirm-overlay.show{display:flex}

.confirm-dialog{
background:var(--light);
padding:24px;
border-radius:16px;
width:300px;
color:var(--dark);
}

.confirm-buttons{
display:flex;
gap:12px;
margin-top:20px;
}

.confirm-btn{
flex:1;
padding:12px;
border-radius:8px;
border:none;
font-weight:600;
cursor:pointer;
}

.confirm{background:var(--accent)}
.cancel{background:#ddd}
</style>
</head>

<body>

<header class="header">
<h1 class="page-title-header">Comment je me sens</h1>
</header>

<div class="profile-banner">Maison</div>

<main class="main-content">

<div style="display:flex;justify-content:space-between;align-items:center">
<h2 class="page-title">Comment je me sens</h2>
<button class="reset-button" onclick="resetAllStates()">â†»</button>
</div>

<p class="instruction-text">Appuyez pour sÃ©lectionner. Appui long pour remettre Ã  zÃ©ro.</p>

<!-- ===== Ã‰TATS PRIORITAIRES ===== -->

<div class="state-item" data-state="SurchargÃ©(e)" data-icon="ğŸ¤¯" onclick="toggleState(this)">
<div class="state-icon">ğŸ¤¯</div>
<div class="state-text">SurchargÃ©(e)</div>
</div>

<div class="state-item" data-state="FatiguÃ©(e)" data-icon="ğŸ˜´" onclick="toggleState(this)">
<div class="state-icon">ğŸ˜´</div>
<div class="state-text">FatiguÃ©(e)</div>
</div>

<div class="state-item" data-state="Confus(e)" data-icon="ğŸ˜µ" onclick="toggleState(this)">
<div class="state-icon">ğŸ˜µ</div>
<div class="state-text">Confus(e)</div>
</div>

<div class="state-item" data-state="Impuissant(e)" data-icon="ğŸ˜" onclick="toggleState(this)">
<div class="state-icon">ğŸ˜</div>
<div class="state-text">Impuissant(e)</div>
</div>

<div class="state-item" data-state="FigÃ©(e) partiellement" data-icon="ğŸ§Š" onclick="toggleState(this)">
<div class="state-icon">ğŸ§Š</div>
<div class="state-text">FigÃ©(e) partiellement</div>
</div>

<div class="state-item" data-state="FigÃ©(e) totalement" data-icon="â›”" onclick="toggleState(this)">
<div class="state-icon">â›”</div>
<div class="state-text">FigÃ©(e) totalement</div>
</div>

<div class="state-item" data-state="Incapable de parler (muet/muette)" data-icon="ğŸ¤" onclick="toggleState(this)">
<div class="state-icon">ğŸ¤</div>
<div class="state-text">Incapable de parler (muet/muette)</div>
</div>

<div class="state-item" data-state="Tendu(e) (tension musculaire)" data-icon="ğŸ’ª" onclick="toggleState(this)">
<div class="state-icon">ğŸ’ª</div>
<div class="state-text">Tendu(e) (tension musculaire)</div>
</div>

<button class="more-toggle" onclick="toggleMore()">â• Voir plus d'Ã©tats</button>

<div id="moreStates" style="display:none">

<!-- ===== Ã‰TATS SECONDAIRES ===== -->

<div class="state-item" data-state="Anxieux(se)" data-icon="ğŸ˜°" onclick="toggleState(this)">
<div class="state-icon">ğŸ˜°</div>
<div class="state-text">Anxieux(se)</div>
</div>

<div class="state-item" data-state="PaniquÃ©(e)" data-icon="ğŸ˜±" onclick="toggleState(this)">
<div class="state-icon">ğŸ˜±</div>
<div class="state-text">PaniquÃ©(e)</div>
</div>

<div class="state-item" data-state="StressÃ©(e)" data-icon="ğŸ˜£" onclick="toggleState(this)">
<div class="state-icon">ğŸ˜£</div>
<div class="state-text">StressÃ©(e)</div>
</div>

<div class="state-item" data-state="Triste" data-icon="ğŸ˜¢" onclick="toggleState(this)">
<div class="state-icon">ğŸ˜¢</div>
<div class="state-text">Triste</div>
</div>

<div class="state-item" data-state="En colÃ¨re" data-icon="ğŸ˜ " onclick="toggleState(this)">
<div class="state-icon">ğŸ˜ </div>
<div class="state-text">En colÃ¨re</div>
</div>

<div class="state-item" data-state="Ã‰tourdi(e)" data-icon="ğŸ˜µâ€ğŸ’«" onclick="toggleState(this)">
<div class="state-icon">ğŸ˜µâ€ğŸ’«</div>
<div class="state-text">Ã‰tourdi(e)</div>
</div>

<div class="state-item" data-state="NausÃ©eux(se)" data-icon="ğŸ¤¢" onclick="toggleState(this)">
<div class="state-icon">ğŸ¤¢</div>
<div class="state-text">NausÃ©eux(se)</div>
</div>

<div class="state-item" data-state="Mal Ã  la tÃªte" data-icon="ğŸ¤•" onclick="toggleState(this)">
<div class="state-icon">ğŸ¤•</div>
<div class="state-text">Mal Ã  la tÃªte</div>
</div>

</div>
</main>

<footer class="footer">
<button class="footer-button icon" onclick="goBack()">â¬…ï¸</button>
<button class="footer-button center" onclick="finish()">Voir le rÃ©capitulatif</button>
<button class="footer-button icon" onclick="goNext()">â¡ï¸</button>
</footer>

<div class="confirm-overlay" id="confirmOverlay">
<div class="confirm-dialog">
<h3>RÃ©initialiser ?</h3>
<p>Tous les Ã©tats seront remis Ã  zÃ©ro.</p>
<div class="confirm-buttons">
<button class="confirm-btn cancel" onclick="hideConfirm()">Annuler</button>
<button class="confirm-btn confirm" onclick="confirmReset()">OK</button>
</div>
</div>
</div>

<script>
let longPressTimer, isLongPress = false;

function toggleState(el){
  if(isLongPress){
    isLongPress = false;
    return;
  }
  el.classList.toggle('active');
  saveEtats();
}

document.querySelectorAll('.state-item').forEach(i => {
  i.addEventListener('mousedown', () => startLong(i));
  i.addEventListener('mouseup', clear);
  i.addEventListener('mouseleave', clear);
  i.addEventListener('touchstart', () => startLong(i));
  i.addEventListener('touchend', clear);
});

function startLong(i){
  isLongPress = false;
  longPressTimer = setTimeout(() => {
    isLongPress = true;
    i.classList.remove('active');
    saveEtats();
  }, 600);
}

function clear(){
  clearTimeout(longPressTimer);
}

function toggleMore(){
  const b = document.getElementById('moreStates');
  b.style.display = b.style.display === 'block' ? 'none' : 'block';
}

function resetAllStates(){
  document.getElementById('confirmOverlay').classList.add('show');
}

function hideConfirm(){
  document.getElementById('confirmOverlay').classList.remove('show');
}

function confirmReset(){
  document.querySelectorAll('.state-item').forEach(i => {
    i.classList.remove('active');
  });
  saveEtats();
  hideConfirm();
}

// Sauvegarde des Ã©tats dans le localStorage
function saveEtats(){
  const etats = [];
  
  document.querySelectorAll('.state-item.active').forEach(item => {
    const label = item.dataset.state || item.querySelector('.state-text').textContent;
    const icon = item.dataset.icon || item.querySelector('.state-icon').textContent;
    
    etats.push({
      label: label,
      icon: icon
    });
  });
  
  localStorage.setItem('currentEtats', JSON.stringify(etats));
  console.log('Ã‰tats sauvegardÃ©s:', etats);
}

// Charger les Ã©tats au dÃ©marrage
function loadEtats(){
  try {
    const saved = localStorage.getItem('currentEtats');
    if(!saved) return;
    
    const etats = JSON.parse(saved);
    
    document.querySelectorAll('.state-item').forEach(item => {
      const label = item.dataset.state || item.querySelector('.state-text').textContent;
      
      const isActive = etats.some(e => e.label === label);
      if(isActive){
        item.classList.add('active');
      }
    });
    
    console.log('Ã‰tats chargÃ©s:', etats);
  } catch(e) {
    console.error('Erreur chargement Ã©tats:', e);
  }
}

function goBack(){
  saveEtats();
  location.href = 'besoins.html';
}

function goNext(){
  saveEtats();
  location.href = 'recap.html';
}

function finish(){
  saveEtats();
  location.href = 'recap.html';
}

// Charger au dÃ©marrage
document.addEventListener('DOMContentLoaded', loadEtats);
</script>

</body>
</html>