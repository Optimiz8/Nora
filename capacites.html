<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="only light">
    <meta name="theme-color" content="#384657">
<link rel="stylesheet" href="nora-common.css">
<title>TSA App â€“ CapacitÃ©s</title>

<style>
body{
  padding-bottom:100px;
}

.page-title-header{font-size:20px}

.profile-banner{
  background:var(--dark);
  padding:12px 20px;
  font-size:16px;
}

.main-content{padding:24px 20px}

.page-title{
  font-size:26px;
  margin-bottom:8px;
}

.instruction-text{
  color:var(--accent);
  font-size:15px;
  margin-bottom:20px;
}

.reset-button{
  background:rgba(245,228,204,.2);
  border:1px solid rgba(245,228,204,.3);
  color:var(--light);
  border-radius:12px;
  font-size:26px;
  padding:8px 14px;
  cursor:pointer;
}

.capacity-item{
  background:var(--light);
  color:var(--dark);
  border-radius:14px;
  padding:14px;
  display:flex;
  align-items:center;
  gap:14px;
  margin-bottom:10px;
  user-select:none;
  transition:.15s;
}

.capacity-item:active{transform:scale(.97)}

.capacity-icon{font-size:24px}
.capacity-text{flex:1;font-size:16px}
.capacity-state{font-size:24px}

.more-toggle{
  margin:22px 0;
  background:none;
  border:none;
  color:var(--accent);
  font-size:16px;
  cursor:pointer;
}

.confirm-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}

.confirm-overlay.show{display:flex}

.confirm-dialog{
  background:var(--light);
  padding:24px;
  border-radius:16px;
  width:300px;
  color:var(--dark);
}

.confirm-buttons{
  display:flex;
  gap:12px;
  margin-top:20px;
}

.confirm-btn{
  flex:1;
  padding:12px;
  border-radius:8px;
  border:none;
  font-weight:600;
  cursor:pointer;
}

.confirm{background:var(--accent)}
.cancel{background:#ddd}
</style>
</head>

<body>

<header class="header">
  <h1 class="page-title-header">CapacitÃ©s</h1>
</header>

<div class="profile-banner">Maison</div>

<main class="main-content">

<div style="display:flex;justify-content:space-between;align-items:center">
  <h2 class="page-title">Mes capacitÃ©s actuelles</h2>
  <button class="reset-button" onclick="resetAllCapacities()">â†»</button>
</div>

<p class="instruction-text">
Appuyez pour changer l'Ã©tat. Appui long pour remettre Ã  zÃ©ro.
</p>

<!-- CAPACITÃ‰S ESSENTIELLES -->
<div class="capacity-item" data-state="empty" data-label="Parler" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸ’¬</div>
  <div class="capacity-text">Parler</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="ÃŠtre touchÃ©e" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸ¤</div>
  <div class="capacity-text">ÃŠtre touchÃ©e</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="Bouger" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸš¶</div>
  <div class="capacity-text">Bouger</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="Rester ici" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸ“</div>
  <div class="capacity-text">Rester ici</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="Comprendre ce qu'on me dit" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸ§ </div>
  <div class="capacity-text">Comprendre ce qu'on me dit</div>
  <div class="capacity-state"></div>
</div>

<button class="more-toggle" onclick="toggleMore()">â• Voir plus de capacitÃ©s</button>

<div id="moreCapacities" style="display:none">

<div class="capacity-item" data-state="empty" data-label="Ã‰crire / taper sur un clavier" onclick="cycleState(this)">
  <div class="capacity-icon">âŒ¨ï¸</div>
  <div class="capacity-text">Ã‰crire / taper sur un clavier</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="Lire" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸ“–</div>
  <div class="capacity-text">Lire</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="RÃ©pondre Ã  des questions" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸ’­</div>
  <div class="capacity-text">RÃ©pondre Ã  des questions</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="Marcher" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸš¶â€â™€ï¸</div>
  <div class="capacity-text">Marcher</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="Rester debout" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸ§</div>
  <div class="capacity-text">Rester debout</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="M'asseoir" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸª‘</div>
  <div class="capacity-text">M'asseoir</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="Me lever" onclick="cycleState(this)">
  <div class="capacity-icon">â¬†ï¸</div>
  <div class="capacity-text">Me lever</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="ÃŠtre proche des autres" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸ‘¥</div>
  <div class="capacity-text">ÃŠtre proche des autres</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="Attendre" onclick="cycleState(this)">
  <div class="capacity-icon">â³</div>
  <div class="capacity-text">Attendre</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="Me concentrer" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸ¯</div>
  <div class="capacity-text">Me concentrer</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="Regarder dans les yeux" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸ‘ï¸</div>
  <div class="capacity-text">Regarder dans les yeux</div>
  <div class="capacity-state"></div>
</div>

<div class="capacity-item" data-state="empty" data-label="Manger" onclick="cycleState(this)">
  <div class="capacity-icon">ğŸ½ï¸</div>
  <div class="capacity-text">Manger</div>
  <div class="capacity-state"></div>
</div>

</div>

</main>

<footer class="footer">
  <button class="footer-button icon" onclick="goBack()">â¬…ï¸</button>
  <button class="footer-button center" onclick="finish()">Voir le rÃ©capitulatif</button>
  <button class="footer-button icon" onclick="goNext()">â¡ï¸</button>
</footer>

<div class="confirm-overlay" id="confirmOverlay">
  <div class="confirm-dialog">
    <h3>RÃ©initialiser ?</h3>
    <p>Toutes les capacitÃ©s seront effacÃ©es.</p>
    <div class="confirm-buttons">
      <button class="confirm-btn cancel" onclick="hideConfirm()">Annuler</button>
      <button class="confirm-btn confirm" onclick="confirmReset()">OK</button>
    </div>
  </div>
</div>

<script>
const STATES={
  empty:{emoji:'',next:'possible'},
  possible:{emoji:'âœ…',next:'difficult'},
  difficult:{emoji:'âš ï¸',next:'impossible'},
  impossible:{emoji:'â›”',next:'unknown'},
  unknown:{emoji:'â“',next:'empty'}
};

let longPressTimer,isLongPress=false;

function cycleState(el){
  if(isLongPress){isLongPress=false;return}
  const n=STATES[el.dataset.state].next;
  el.dataset.state=n;
  el.querySelector('.capacity-state').textContent=STATES[n].emoji;
  saveCapacities();
}

document.querySelectorAll('.capacity-item').forEach(i=>{
  i.addEventListener('mousedown',()=>startLong(i));
  i.addEventListener('mouseup',clear);
  i.addEventListener('mouseleave',clear);
  i.addEventListener('touchstart',()=>startLong(i));
  i.addEventListener('touchend',clear);
});

function startLong(i){
  isLongPress=false;
  longPressTimer=setTimeout(()=>{
    isLongPress=true;
    i.dataset.state='empty';
    i.querySelector('.capacity-state').textContent='';
    saveCapacities();
  },600);
}

function clear(){clearTimeout(longPressTimer)}

function toggleMore(){
  const b=document.getElementById('moreCapacities');
  b.style.display=b.style.display==='block'?'none':'block';
}

function resetAllCapacities(){
  document.getElementById('confirmOverlay').classList.add('show');
}

function hideConfirm(){
  document.getElementById('confirmOverlay').classList.remove('show');
}

function confirmReset(){
  document.querySelectorAll('.capacity-item').forEach(i=>{
    i.dataset.state='empty';
    i.querySelector('.capacity-state').textContent='';
  });
  saveCapacities();
  hideConfirm();
}

// Sauvegarde des capacitÃ©s dans le localStorage
function saveCapacities(){
  const capacites = {
    impossible: [],
    difficile: [],
    possible: [],
    incertain: []
  };
  
  document.querySelectorAll('.capacity-item').forEach(item => {
    const state = item.dataset.state;
    const label = item.dataset.label || item.querySelector('.capacity-text').textContent;
    
    if(state === 'impossible'){
      capacites.impossible.push(label);
    } else if(state === 'difficult'){
      capacites.difficile.push(label);
    } else if(state === 'possible'){
      capacites.possible.push(label);
    } else if(state === 'unknown'){
      capacites.incertain.push(label);
    }
  });
  
  localStorage.setItem('currentCapacites', JSON.stringify(capacites));
  console.log('CapacitÃ©s sauvegardÃ©es:', capacites);
}

// Charger les capacitÃ©s au dÃ©marrage
function loadCapacities(){
  try {
    const saved = localStorage.getItem('currentCapacites');
    if(!saved) return;
    
    const capacites = JSON.parse(saved);
    
    document.querySelectorAll('.capacity-item').forEach(item => {
      const label = item.dataset.label || item.querySelector('.capacity-text').textContent;
      
      if(capacites.impossible.includes(label)){
        item.dataset.state = 'impossible';
        item.querySelector('.capacity-state').textContent = 'â›”';
      } else if(capacites.difficile.includes(label)){
        item.dataset.state = 'difficult';
        item.querySelector('.capacity-state').textContent = 'âš ï¸';
      } else if(capacites.possible.includes(label)){
        item.dataset.state = 'possible';
        item.querySelector('.capacity-state').textContent = 'âœ…';
      } else if(capacites.incertain.includes(label)){
        item.dataset.state = 'unknown';
        item.querySelector('.capacity-state').textContent = 'â“';
      }
    });
  } catch(e) {
    console.error('Erreur chargement capacitÃ©s:', e);
  }
}

function goBack(){
  saveCapacities();
  location.href='index.html';
}

function goNext(){
  saveCapacities();
  location.href='besoins.html';
}

function finish(){
  saveCapacities();
  location.href='recap.html';
}

// Charger au dÃ©marrage
document.addEventListener('DOMContentLoaded', function() {
  loadCapacities();
  
  // Enregistrer l'heure de dÃ©but de la crise si pas dÃ©jÃ  fait
  if (!localStorage.getItem('crisisStartTime')) {
    localStorage.setItem('crisisStartTime', Date.now().toString());
    console.log('Heure de dÃ©but de crise enregistrÃ©e');
  }
});
</script>

</body>
</html>