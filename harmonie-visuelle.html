<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="stylesheet" href="nora-common.css">
    <title>Nora - Harmonie visuelle</title>
    <style>
        html {
            overflow: hidden;
            height: 100%;
        }

        body {
            overflow: hidden;
            height: 100%;
            margin: 0;
        }

        .main-f {
            position: fixed;
            top: var(--header-height);
            left: 0;
            right: 0;
            bottom: var(--footer-height);
            display: flex;
            justify-content: center;
            align-items: center;
            background: #1a2129;
        }

        .container {
            width: 85%; 
            height: 85%; 
            display: flex; 
            flex-direction: column;
            justify-content: space-around; 
            align-items: center;
        }

        .bar {
            width: 100%; 
            height: 1px;
            background: rgba(245, 228, 204, 0.08);
            position: relative;
        }

        .dot {
            position: absolute;
            height: 16px; 
            width: 16px;
            background: var(--accent);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--accent);
            top: -8px;
            left: 0;
            will-change: transform;
        }
    </style>
</head>
<body>
    <header class="header">
        <button class="back-button" onclick="if(localStorage.getItem('calmSource')==='recap'){localStorage.removeItem('calmSource');location.href='recap.html'}else{location.href='index.html#calm'}" aria-label="Retour">‚¨ÖÔ∏è</button>
        <h1 class="page-title">Harmonie visuelle</h1>
        <button class="header-icon" onclick="location.href='index.html'" style="margin-left: auto;" aria-label="Accueil">üè†</button>
    </header>

    <main class="main-f">
        <div class="container" id="barContainer"></div>
    </main>

    <footer class="footer">
        <button id="modeBtn" class="footer-button center" onclick="nextMode()">Mode 1</button>
        <button class="footer-button center" onclick="changeSpeed()">Vitesse : <span id="speedTxt">1x</span></button>
    </footer>

    <script>
        const container = document.getElementById('barContainer');
        const modeBtn = document.getElementById('modeBtn');
        const speedTxt = document.getElementById('speedTxt');
        const count = 18; 
        
        // RECALIBRAGE : 0.9 est la nouvelle base "1x" (√©quivalent √† l'ancien 1.5x)
        const levels = [0.15, 0.45, 0.9, 1.35, 1.8];
        const names = ["0.2x", "0.5x", "1x", "1.5x", "2x"];
        let speedIndex = 2; // Index de "1x"
        let speed = levels[speedIndex];
        
        let currentMode = 0;
        const dots = [];

        for (let i = 0; i < count; i++) {
            const bar = document.createElement('div');
            bar.className = 'bar';
            const dot = document.createElement('div');
            dot.className = 'dot';
            bar.appendChild(dot);
            container.appendChild(bar);
            dots.push({ el: dot, index: i });
        }

        function nextMode() {
            currentMode = (currentMode + 1) % 5;
            modeBtn.innerText = "Mode " + (currentMode + 1);
            if (navigator.vibrate) navigator.vibrate(15);
        }

        function changeSpeed() {
            speedIndex = (speedIndex + 1) % levels.length;
            speed = levels[speedIndex];
            speedTxt.innerText = names[speedIndex];
            if (navigator.vibrate) navigator.vibrate(10);
        }

        function animate(time) {
            const t = (time / 1000) * speed;
            const width = container.offsetWidth - 16;
            
            dots.forEach((dot, i) => {
                let pos;
                
                if (currentMode === 0) {
                    // Mode 1: Harmonie
                    const frequency = (10 + i) / 10; 
                    pos = (Math.sin(t * frequency) + 1) / 2;
                } 
                else if (currentMode === 1) {
                    // Mode 2: Cascade
                    pos = (Math.sin(t * 2.5 - i * 0.35) + 1) / 2;
                } 
                else if (currentMode === 2) {
                    // Mode 3: Miroir
                    const dir = i % 2 === 0 ? 1 : -1;
                    pos = (Math.sin(t * 2.2 * dir) + 1) / 2;
                }
                else if (currentMode === 3) {
                    // Mode 4: ADN
                    const speedMult = 2.2;
                    const wave = Math.sin(t * speedMult + (i * 0.5));
                    const perspective = Math.cos(t * speedMult + (i * 0.5));
                    const side = (i % 2 === 0) ? 1 : -1;
                    
                    pos = 0.5 + (wave * 0.35 * side);
                    dot.el.style.opacity = 0.3 + (perspective + 1) * 0.35;
                }
                else {
                    // Mode 5: Spirale
                    const rotation = Math.sin(t * 2.2 + (i * 0.3));
                    const perspective = Math.cos(t * 2.2 + (i * 0.3));
                    
                    pos = (rotation + 1) / 2;
                    dot.el.style.opacity = 0.2 + (perspective + 1) * 0.4;
                }

                dot.el.style.transform = `translateX(${pos * width}px)`;
            });
            
            requestAnimationFrame(animate);
        }

        requestAnimationFrame(animate);
    </script>

</body>
</html>